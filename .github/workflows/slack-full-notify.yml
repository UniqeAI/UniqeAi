name: ğŸ”” KapsamlÄ± Slack Bildirimleri

on:
  # Push events - tÃ¼m branch'lerde
  push:
    branches: 
      - '**'  # TÃ¼m branch'ler
  
  # Branch/Tag oluÅŸturma
  create:
  
  # Branch/Tag silme
  delete:
  
  # Pull Request events
  pull_request:
    types: [opened, closed, reopened, edited, synchronize, ready_for_review, converted_to_draft]
  
  # Pull Request Review events
  pull_request_review:
    types: [submitted, edited, dismissed]
  
  # Pull Request Review Comment events
  pull_request_review_comment:
    types: [created, edited, deleted]
  
  # Issue events
  issues:
    types: [opened, closed, reopened, edited, deleted, transferred, assigned, unassigned, labeled, unlabeled]
  
  # Issue Comment events
  issue_comment:
    types: [created, edited, deleted]
  
  # Discussion events
  discussion:
    types: [created, edited, deleted, transferred, answered, unanswered]
  
  # Discussion Comment events
  discussion_comment:
    types: [created, edited, deleted]
  
  # Release events
  release:
    types: [published, edited, deleted, prereleased, released]
  
  # Wiki events
  gollum:
  
  # Workflow run events
  workflow_run:
    types: [completed, requested]
  
  # Star events
  watch:
    types: [started]
  
  # Fork events
  fork:
  
  # Repository events
  repository:
    types: [created, deleted, archived, unarchived, publicized, privatized]

jobs:
  slack-notify:
    runs-on: ubuntu-latest
    if: github.event_name != 'workflow_run' || github.event.workflow_run.conclusion != 'cancelled'
    
    steps:
      - name: ğŸ“Š GitHub Event Bilgilerini Topla
        id: event-info
        run: |
          echo "EVENT_NAME=${{ github.event_name }}" >> $GITHUB_OUTPUT
          echo "ACTOR=${{ github.actor }}" >> $GITHUB_OUTPUT
          echo "REPO=${{ github.repository }}" >> $GITHUB_OUTPUT
          echo "REF_NAME=${{ github.ref_name }}" >> $GITHUB_OUTPUT
          echo "SHA_SHORT=$(echo ${{ github.sha }} | cut -c1-7)" >> $GITHUB_OUTPUT
          echo "REPO_URL=https://github.com/${{ github.repository }}" >> $GITHUB_OUTPUT
          
      - name: ğŸ”” Slack Bildirimi GÃ¶nder
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        run: |
          # Temel bilgiler
          EVENT_NAME="${{ steps.event-info.outputs.EVENT_NAME }}"
          ACTOR="${{ steps.event-info.outputs.ACTOR }}"
          REPO="${{ steps.event-info.outputs.REPO }}"
          REF_NAME="${{ steps.event-info.outputs.REF_NAME }}"
          SHA_SHORT="${{ steps.event-info.outputs.SHA_SHORT }}"
          REPO_URL="${{ steps.event-info.outputs.REPO_URL }}"
          
          # Event'e gÃ¶re mesaj oluÅŸtur
          case "$EVENT_NAME" in
            push)
              COMMIT_MSG="${{ github.event.head_commit.message }}"
              COMMIT_URL="${{ github.event.head_commit.url }}"
              COMMITS_COUNT="${{ github.event.commits[0] && length(github.event.commits) || 1 }}"
              
              if [[ "$COMMITS_COUNT" -eq 1 ]]; then
                TEXT="ğŸš€ **${ACTOR}** \`${REF_NAME}\` branch'ine commit attÄ±:\n> ğŸ“ *${COMMIT_MSG}*\nğŸ”— <${COMMIT_URL}|${SHA_SHORT}>"
              else
                TEXT="ğŸš€ **${ACTOR}** \`${REF_NAME}\` branch'ine ${COMMITS_COUNT} commit attÄ±\nğŸ”— <${REPO_URL}/compare/${REF_NAME}|DeÄŸiÅŸiklikleri gÃ¶rÃ¼ntÃ¼le>"
              fi
              ;;
              
            create)
              REF_TYPE="${{ github.event.ref_type }}"
              if [[ "$REF_TYPE" == "branch" ]]; then
                TEXT="ğŸŒ¿ **${ACTOR}** yeni branch oluÅŸturdu: \`${REF_NAME}\`\nğŸ”— <${REPO_URL}/tree/${REF_NAME}|Branch'i gÃ¶rÃ¼ntÃ¼le>"
              else
                TEXT="ğŸ·ï¸ **${ACTOR}** yeni tag oluÅŸturdu: \`${REF_NAME}\`\nğŸ”— <${REPO_URL}/releases/tag/${REF_NAME}|Tag'i gÃ¶rÃ¼ntÃ¼le>"
              fi
              ;;
              
            delete)
              REF_TYPE="${{ github.event.ref_type }}"
              REF="${{ github.event.ref }}"
              if [[ "$REF_TYPE" == "branch" ]]; then
                TEXT="ğŸ—‘ï¸ **${ACTOR}** branch sildi: \`${REF}\`"
              else
                TEXT="ğŸ—‘ï¸ **${ACTOR}** tag sildi: \`${REF}\`"
              fi
              ;;
              
            pull_request)
              PR_TITLE="${{ github.event.pull_request.title }}"
              PR_URL="${{ github.event.pull_request.html_url }}"
              PR_NUMBER="${{ github.event.pull_request.number }}"
              PR_ACTION="${{ github.event.action }}"
              BASE_BRANCH="${{ github.event.pull_request.base.ref }}"
              HEAD_BRANCH="${{ github.event.pull_request.head.ref }}"
              
              case "$PR_ACTION" in
                opened)
                  TEXT="ğŸ“‹ **${ACTOR}** yeni Pull Request aÃ§tÄ±:\n> ğŸ¯ *${PR_TITLE}*\nğŸ“Š \`${HEAD_BRANCH}\` â†’ \`${BASE_BRANCH}\`\nğŸ”— <${PR_URL}|PR #${PR_NUMBER}>"
                  ;;
                closed)
                  if [[ "${{ github.event.pull_request.merged }}" == "true" ]]; then
                    TEXT="âœ… **${ACTOR}** Pull Request'i merge etti:\n> ğŸ¯ *${PR_TITLE}*\nğŸ“Š \`${HEAD_BRANCH}\` â†’ \`${BASE_BRANCH}\`\nğŸ”— <${PR_URL}|PR #${PR_NUMBER}>"
                  else
                    TEXT="âŒ **${ACTOR}** Pull Request'i kapattÄ±:\n> ğŸ¯ *${PR_TITLE}*\nğŸ”— <${PR_URL}|PR #${PR_NUMBER}>"
                  fi
                  ;;
                *)
                  TEXT="ğŸ”„ **${ACTOR}** Pull Request gÃ¼ncelledi ($PR_ACTION):\n> ğŸ¯ *${PR_TITLE}*\nğŸ”— <${PR_URL}|PR #${PR_NUMBER}>"
                  ;;
              esac
              ;;
              
            pull_request_review)
              PR_TITLE="${{ github.event.pull_request.title }}"
              PR_URL="${{ github.event.pull_request.html_url }}"
              PR_NUMBER="${{ github.event.pull_request.number }}"
              REVIEW_STATE="${{ github.event.review.state }}"
              
              case "$REVIEW_STATE" in
                approved)
                  TEXT="âœ… **${ACTOR}** Pull Request'i onayladÄ±:\n> ğŸ¯ *${PR_TITLE}*\nğŸ”— <${PR_URL}|PR #${PR_NUMBER}>"
                  ;;
                changes_requested)
                  TEXT="ğŸ”„ **${ACTOR}** Pull Request'te deÄŸiÅŸiklik istedi:\n> ğŸ¯ *${PR_TITLE}*\nğŸ”— <${PR_URL}|PR #${PR_NUMBER}>"
                  ;;
                *)
                  TEXT="ğŸ‘€ **${ACTOR}** Pull Request'i inceledi:\n> ğŸ¯ *${PR_TITLE}*\nğŸ”— <${PR_URL}|PR #${PR_NUMBER}>"
                  ;;
              esac
              ;;
              
            issues)
              ISSUE_TITLE="${{ github.event.issue.title }}"
              ISSUE_URL="${{ github.event.issue.html_url }}"
              ISSUE_NUMBER="${{ github.event.issue.number }}"
              ISSUE_ACTION="${{ github.event.action }}"
              
              case "$ISSUE_ACTION" in
                opened)
                  TEXT="ğŸ› **${ACTOR}** yeni Issue aÃ§tÄ±:\n> ğŸ“ *${ISSUE_TITLE}*\nğŸ”— <${ISSUE_URL}|Issue #${ISSUE_NUMBER}>"
                  ;;
                closed)
                  TEXT="âœ… **${ACTOR}** Issue'yu kapattÄ±:\n> ğŸ“ *${ISSUE_TITLE}*\nğŸ”— <${ISSUE_URL}|Issue #${ISSUE_NUMBER}>"
                  ;;
                *)
                  TEXT="ğŸ”„ **${ACTOR}** Issue'yu gÃ¼ncelledi ($ISSUE_ACTION):\n> ğŸ“ *${ISSUE_TITLE}*\nğŸ”— <${ISSUE_URL}|Issue #${ISSUE_NUMBER}>"
                  ;;
              esac
              ;;
              
            issue_comment)
              ISSUE_TITLE="${{ github.event.issue.title }}"
              ISSUE_URL="${{ github.event.issue.html_url }}"
              ISSUE_NUMBER="${{ github.event.issue.number }}"
              COMMENT_BODY="${{ github.event.comment.body }}"
              COMMENT_BODY_SHORT=$(echo "$COMMENT_BODY" | head -c 100)
              
              TEXT="ğŸ’¬ **${ACTOR}** Issue'ya yorum yaptÄ±:\n> ğŸ“ *${ISSUE_TITLE}*\n> ğŸ’­ ${COMMENT_BODY_SHORT}...\nğŸ”— <${ISSUE_URL}|Issue #${ISSUE_NUMBER}>"
              ;;
              
            release)
              RELEASE_NAME="${{ github.event.release.name }}"
              RELEASE_TAG="${{ github.event.release.tag_name }}"
              RELEASE_URL="${{ github.event.release.html_url }}"
              RELEASE_ACTION="${{ github.event.action }}"
              
              TEXT="ğŸ‰ **${ACTOR}** yeni release yayÄ±nladÄ± ($RELEASE_ACTION):\n> ğŸ·ï¸ *${RELEASE_NAME}* (${RELEASE_TAG})\nğŸ”— <${RELEASE_URL}|Release'i gÃ¶rÃ¼ntÃ¼le>"
              ;;
              
            watch)
              TEXT="â­ **${ACTOR}** repository'yi yÄ±ldÄ±zladÄ±!\nğŸ”— <${REPO_URL}|${REPO}>"
              ;;
              
            fork)
              FORK_URL="${{ github.event.forkee.html_url }}"
              TEXT="ğŸ´ **${ACTOR}** repository'yi fork'ladÄ±!\nğŸ”— <${FORK_URL}|Fork'u gÃ¶rÃ¼ntÃ¼le>"
              ;;
              
            gollum)
              PAGES_COUNT="${{ length(github.event.pages) }}"
              TEXT="ğŸ“š **${ACTOR}** Wiki'yi gÃ¼ncelledi (${PAGES_COUNT} sayfa)\nğŸ”— <${REPO_URL}/wiki|Wiki'yi gÃ¶rÃ¼ntÃ¼le>"
              ;;
              
            workflow_run)
              WORKFLOW_NAME="${{ github.event.workflow_run.name }}"
              WORKFLOW_CONCLUSION="${{ github.event.workflow_run.conclusion }}"
              WORKFLOW_URL="${{ github.event.workflow_run.html_url }}"
              
              case "$WORKFLOW_CONCLUSION" in
                success)
                  TEXT="âœ… **Workflow baÅŸarÄ±lÄ±:** *${WORKFLOW_NAME}*\nğŸ‘¤ Tetikleyen: ${ACTOR}\nğŸ”— <${WORKFLOW_URL}|Workflow'u gÃ¶rÃ¼ntÃ¼le>"
                  ;;
                failure)
                  TEXT="âŒ **Workflow baÅŸarÄ±sÄ±z:** *${WORKFLOW_NAME}*\nğŸ‘¤ Tetikleyen: ${ACTOR}\nğŸ”— <${WORKFLOW_URL}|Hata detaylarÄ±nÄ± gÃ¶rÃ¼ntÃ¼le>"
                  ;;
                *)
                  TEXT="âš ï¸ **Workflow tamamlandÄ±:** *${WORKFLOW_NAME}* (${WORKFLOW_CONCLUSION})\nğŸ‘¤ Tetikleyen: ${ACTOR}\nğŸ”— <${WORKFLOW_URL}|Workflow'u gÃ¶rÃ¼ntÃ¼le>"
                  ;;
              esac
              ;;
              
            *)
              TEXT="ğŸ“¢ **${ACTOR}** bir etkinlik gerÃ§ekleÅŸtirdi: *${EVENT_NAME}*\nğŸ”— <${REPO_URL}|${REPO}>"
              ;;
          esac
          
          # Slack formatÄ±nda JSON payload oluÅŸtur
          PAYLOAD=$(cat <<EOF
          {
            "text": "${TEXT}",
            "blocks": [
              {
                "type": "section",
                "text": {
                  "type": "mrkdwn", 
                  "text": "${TEXT}"
                }
              },
              {
                "type": "context",
                "elements": [
                  {
                    "type": "mrkdwn",
                    "text": "ğŸ“… $(date '+%Y-%m-%d %H:%M:%S UTC') | ğŸ·ï¸ Event: \`${EVENT_NAME}\` | ğŸ“‚ <${REPO_URL}|${REPO}>"
                  }
                ]
              }
            ]
          }
          EOF
          )
          
          # Slack'e gÃ¶nder
          curl -X POST \
            -H 'Content-type: application/json' \
            -d "$PAYLOAD" \
            "$SLACK_WEBHOOK_URL"
          
          echo "âœ… Slack bildirimi gÃ¶nderildi: $EVENT_NAME" 
